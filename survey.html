<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>FriendFinder</title>

	<!-- Latest compiled and minified CSS & JS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

	<!-- Font Awesome Glyphicons -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
	<link rel="stylesheet" media="screen" href="https://bootswatch.com/darkly/bootstrap.css">

</head>
<body>
<style>
option,
select{
	color:black;
}
</style>

	<div class="container">

		<h2>Survey Questions</h2>
		<hr>

		<h3><strong>About You</strong></h3>
		<h4>Name (Required)</h4>
		<input type="text" name="" id="name" class="form-control" required >

		<h4>Link to Photo Image (Required)</h4>
		<input type="text" name="" id="photo" class="form-control" required >

		<hr>

		<h3><strong>Question 1</strong></h3>
		<h4>Your mind is always buzzing with unexplored ideas and plans.</h4>
	 	<select data-placeholder="" class="chosen-select" id="q1">
	 		<option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
      	</select>

		<h3><strong>Question 2</strong></h3>
		<h4>Generally speaking, you rely more on your experience than your imagination.</h4>
	 	<select data-placeholder="" class="chosen-select" id="q2">
	 		<option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
      	</select>


		<h3><strong>Question 3</strong></h3>
		<h4>You find it easy to stay relaxed and focused even when there is some pressure.</h4>
	 	<select data-placeholder="" class="chosen-select" id="q3">
	 		<option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
      	</select>


		<h3><strong>Question 4</strong></h3>
		<h4>You rarely do something just out of sheer curiosity.</h4>
	 	<select data-placeholder="" class="chosen-select" id="q4">
	 		<option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
      	</select>


		<h3><strong>Question 5</strong></h3>
		<h4>People can rarely upset you.</h4>
	 	<select data-placeholder="" class="chosen-select" id="q5">
	 		<option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
      	</select>


		<h3><strong>Question 6</strong></h3>
		<h4>It is often difficult for you to relate to other people’s feelings.</h4>
	 	<select data-placeholder="" class="chosen-select" id="q6">
	 		<option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
      	</select>


		<h3><strong>Question 7</strong></h3>
		<h4>In a discussion, truth should be more important than people’s sensitivities.</h4>
	 	<select data-placeholder="" class="chosen-select" id="q7">
	 		<option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
      	</select>

		<h3><strong>Question 8</strong></h3>
		<h4>You rarely get carried away by fantasies and ideas.</h4>
	 	<select data-placeholder="" class="chosen-select" id="q8">
	 		<option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
      	</select>

		<h3><strong>Question 9</strong></h3>
		<h4>You think that everyone’s views should be respected regardless of whether they are supported by facts or not.</h4>
	 	<select data-placeholder="" class="chosen-select" id="q9">
	 		<option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
      	</select>

		<h3><strong>Question 10</strong></h3>
		<h4>You feel more energetic after spending time with a group of people.</h4>
	 	<select data-placeholder="" class="chosen-select" id="q10">
	 		<option value=""></option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
      	</select>

		<br>
		<br>

		<!-- Submit Button -->
		<button type="submit" class="btn btn-primary btn-lg btn-block" id="submit"><i class="fa fa-check-circle" aria-hidden="true"></i>
 Submit</button>

		<hr>
	    <footer class="footer">
	      <div class="container">
		        <p><a href="/api/friends">API Friends List</a> | <a href="https://github.com/Pholtzman88/friend_finder">GitHub Repo</a></p>
	      </div>
	    </footer>

	</div>

<!-- Large modal -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="row">
      		<!--you-->
		  <div class="col-sm-6 col-md-4">
		    <div class="thumbnail">
		      <img  class="img" id="yourImg">
		      <div class="caption">
		        <h3 id="yourName"></h3>
		      </div>
		    </div>
		  </div>
		  <!--middle section-->
		  <div class="col-sm-6 col-md-4" id="middle">
		  	<h2 id="comment"></h2>
		  </div>
		  <!--your match-->     		
		  <div class="col-sm-6 col-md-4">
		    <div class="thumbnail">
		      <img  class="img" id="matchedImg">
		      <div class="caption">
		        <h3 id="matchedName"></h3>
		      </div>
		    </div>
		  </div>
		</div>
    </div>
  </div>
</div>
<style type="text/css">
.img {
	max-height:300px;
	max-width:300px;
}
.caption,
#middle {
	text-align: center;
}
.thumbnail {
	height:400px;
}
</style>
</body>
<script type="text/javascript">
//setup constructor for profile
var Profile = function(name,photoURL,scores){
	this.name = name,
	this.photoURL = photoURL,
	this.scores = scores
};
$("#submit").on("click", function(){
	matchUserWithFriend();
});

//validate form and create user profile
function matchUserWithFriend(){
	//set name to be used in profile constructor & form validation
	var name = $("#name").val().trim();
	//set photoURL to be used in profile constructor & form validation
	var photoURL = $("#photo").val().trim();
	//set question to be used for form validation
	var question = $(".chosen-select").val();
	//set scores to hold answers for profile constructor
	var scores = [];
	//loop through answers from to get user scores as an array
	for(i=0;i<10;i++){
		//set num for identifying questions
		var num = i + 1;
		//set answer to value question as num increments
		var answer = $("#q"+ num).val();
		//turn answer into an integer
		answer = parseInt(answer);
		//push answer to scores array
		scores.push(answer);
	};

	function validate(){
		valid = true;
		invalid = false;

		if (name === ""){
			return invalid;
		}
		if (photoURL === ""){
			return invalid;
		}
		if (question === ""){
			return invalid;
		}
		return valid;
	}
	//set validation function as a var
	var validation = validate();
	//if validation returns as valid
	if (validation === valid){
		
		//create user profile
		var userProfile = new Profile(name, photoURL, scores);
		//update user infor thumbnail in modal
		$("#yourImg").attr("src",userProfile.photoURL);
		$("#yourName").html(userProfile.name);
		//	send user profile to server to be processed and sent to api/friends
		$.post("/api/new",userProfile,function(){
			console.log("hello")
		});

		//get all profiles for user matching
		$.get("/api/friends", function(res){
			console.log("hello")
			//set array to hold candidates to avoid the user matching him himself/herself
			var candidates = [];
			//set total user score var to compare user and db scores
			var totalUserScore = 0;
			//set array to hold total score for each candidate
			var canScores = [];
			//set array to hold matches
			var matches = [];


			function userTotal(){
				//loop through user scores to get total score
				for(var j=0;j<userProfile.scores.length;j++){
					//set score var and parse to integer
					var score = parseInt(userProfile.scores[j]);
					//increase total user score value by each individual score
					totalUserScore += score;
				};
				return totalUserScore;
			}
			function getCandidates(){
				for(var i=0;i<res.length;i++){
					if (res[i].photoURL !== userProfile.photoURL && res[i].name !== userProfile.name){
						candidates.push(res[i]);
					}
				}
			}

			function candidateTotals(){
				//loop through to get total scores for each candidate
				for(var i=0;i<candidates.length;i++){
					//set candidate score to 0 each time i iterates
					var candidateScore = 0;
					//loop though each candidates scores and add them together
					for (var k=0;k<10;k++){
						candidateScore += parseInt(candidates[i].scores[k]);
					}
					//push candidate score to can scores array for each candidate
					canScores.push(candidateScore);
				};
			}
				
				function closest(num,arr){
					//set curr to first number in array
					//curr is current closest number
	                var curr = arr[0];
	                //set diff to absolute val of num - curr
	                var diff = Math.abs (num - curr);
	                //loop through each number in array
	                for (var l = 0; l < arr.length; l++) {
	                	//set new diff var
	                    var newdiff = Math.abs (num - arr[l]);
	                    //if new diff is lower than old diff
	                    if (newdiff < diff) {
	                    	//set diff to new diff
	                        diff = newdiff;
	                        //set curr to that number
	                        curr = arr[l];
	                    };
	                };
	                //return value of closest number
	                return curr;
	            };

	            function getMatches(){
		            //set closest score var to use closest function to find the best matched score
		            var closestScore = closest(totalUserScore,canScores);
		            //loop through candidates
		            for(var m = 0;m<candidates.length;m++){
		            	//if a candidates total score is the closest to the users total score
		            if(canScores[m] == closestScore){
		            		//push candidate object to matches array if the match does not have the same name
		            			matches.push(candidates[m]);
		            	};
		            };
	            }

	            function displayMatch(){
		            //set random number var to use as index for match in matches array
		            var random = Math.floor(Math.random()*matches.length);
		            //if matches exist
		            if (matches.length > 0){
		            	//set matched friend variable to a random match with closest score
		            	var matchedFriend = matches[random];
		            		//update html
			            	$("#comment").html("Congratulations! It's a Match!");
		            }else{
		            	//if there are no matches other than the user make matched friend no one
		            	var matchedFriend = new Profile("Forever Alone","https://acculturated.com/wp-content/uploads/2016/04/Loneliness_blog_photo_3-13.jpg")
		            	$("#comment").html("well this just got awkward.. you are the only one here!");
		            };
		            //update matched friend thumbnail in modal
		           	$("#matchedImg").attr("src",matchedFriend.photoURL);
		           	$("#matchedName").html(matchedFriend.name);
	            }


	            //calculate user total
	            userTotal();
	            //get potential candidates for matching
	            getCandidates();
	            //calculate candidate totals
	            candidateTotals();
	            //get all matches
	            getMatches();
	            //diplay a random match from matches
	            displayMatch();

			})
		
		//trigger modal
		$(".modal").modal("toggle");
	}else{
		//if the client does not enter values for all fields
		alert("please enter all form fields for best results..")
	};
}

</script>
</html>